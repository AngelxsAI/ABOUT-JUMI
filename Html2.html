<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JUMI - Grupo Juvenil Católico</title>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  
  <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,400;0,700;0,900;1,300&display=swap" rel="stylesheet">
  
  <style>
    /* VARIABLES DE COLOR */
    :root {
      --primary: #6a0dad; /* Morado JUMI */
      --accent: #00bcd4; /* Celeste JUMI */
      --secondary: #000;
      --background: #f8f8ff;
      --text-color: #333;
      --shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
      --transition: all 0.3s ease;
    }

    /* ESTILOS GLOBALES Y RESET */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Poppins', sans-serif;
    }

    body {
      background-color: var(--background);
      color: var(--text-color);
      line-height: 1.6;
      scroll-behavior: smooth;
    }

    a {
      text-decoration: none;
      color: var(--primary);
    }

    /* HEADER */
    header {
      background: linear-gradient(135deg, var(--primary), #8f2fdc);
      color: white;
      padding: 25px 20px;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      text-align: center;
    }
    .logo {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .cruz-icon {
      /* Estilos para el SVG */
      width: 60px; /* Tamaño de la cruz aumentado */
      height: 60px;
      fill: white;
      margin-bottom: 10px;
      filter: drop-shadow(0 0 5px rgba(255, 255, 255, 0.5)); /* Pequeño brillo */
    }
    header h1 {
      font-size: 2.5rem; /* Título más grande */
      font-weight: 900;
      letter-spacing: 3px;
    }
    .header-subtitle {
      font-size: 1rem;
      opacity: 0.9;
      margin-top: 5px;
    }
    .angel-credit {
        font-size: 0.85rem;
        font-style: italic;
        opacity: 0.7;
        margin-top: 5px;
        font-weight: 300;
    }

    /* NAVEGACIÓN */
    .main-nav {
      position: sticky;
      top: 0;
      z-index: 1000;
      background-color: white;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    }
    .nav-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 15px;
    }
    .nav-links {
      list-style: none;
      display: flex;
      justify-content: center;
      padding: 10px 0;
      flex-wrap: wrap;
    }
    .nav-links li a {
      color: var(--primary);
      padding: 10px 18px;
      display: block;
      font-weight: 600;
      border-radius: 25px;
      transition: var(--transition);
      font-size: 0.95em;
    }
    .nav-links li a:hover {
      background-color: var(--accent);
      color: white;
      transform: translateY(-2px);
    }
    .mobile-menu-btn {
      display: none;
      background: none;
      border: none;
      color: var(--primary);
      font-size: 1.5rem;
      padding: 15px;
      cursor: pointer;
      width: 100%;
      text-align: left;
    }

    /* VERSÍCULO DEL DÍA */
    #versiculo-del-dia {
      background: linear-gradient(135deg, var(--accent), #7deaf9);
      color: white;
      padding: 25px 15px;
      text-align: center;
      box-shadow: var(--shadow);
      margin: 25px 0;
      border-radius: 15px;
    }
    .contenido-verso {
      max-width: 800px;
      margin: 0 auto;
    }
    .texto-verso {
      font-style: italic;
      font-size: 1.25rem;
      margin-bottom: 15px;
      font-weight: 500;
    }
    .referencia-verso {
      font-weight: 700;
      font-size: 1rem;
      opacity: 0.9;
    }
    .botones-compartir {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 15px;
    }
    .btn-compartir {
      background-color: var(--primary);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 600;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 3px 6px rgba(0, 0, 0, 0.2);
    }
    .btn-compartir:hover {
      background-color: #510a8d;
      transform: translateY(-2px);
    }

    /* SECCIONES GENERALES */
    main {
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }
    .section {
      background-color: white;
      padding: 35px;
      margin-bottom: 35px;
      border-radius: 12px;
      box-shadow: var(--shadow);
      opacity: 0; 
      transform: translateY(20px);
      transition: opacity 0.6s ease-out, transform 0.6s ease-out;
    }
    .section.visible {
      opacity: 1;
      transform: translateY(0);
    }
    .section h2 {
      color: var(--primary);
      margin-bottom: 25px;
      border-bottom: 3px solid var(--accent);
      padding-bottom: 10px;
      font-size: 1.8rem;
    }

    /* BOTONES GRUPO */
    .btn-group {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      justify-content: center;
    }
    .btn {
      padding: 12px 25px;
      border-radius: 50px;
      font-weight: 700;
      text-transform: uppercase;
      transition: var(--transition);
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
    }
    .btn-primary {
      background-color: var(--primary);
      color: white;
      border: 2px solid var(--primary);
    }
    .btn-primary:hover {
      background-color: var(--accent);
      border-color: var(--accent);
      transform: scale(1.05);
    }
    .btn-secondary {
      background-color: transparent;
      color: var(--primary);
      border: 2px solid var(--primary);
    }
    .btn-secondary:hover {
      background-color: var(--primary);
      color: white;
    }

    /* GENERADOR DE INSPIRACIÓN */
    #generador-inspiracion {
        text-align: center;
        background-color: #e3f2fd; /* Fondo azul claro */
    }
    #mensajeInput {
        width: 100%;
        min-height: 120px;
        padding: 15px;
        border: 2px solid var(--accent);
        border-radius: 8px;
        margin-bottom: 20px;
        transition: border-color 0.3s;
        font-size: 1rem;
        resize: vertical;
    }
    #mensajeInput:focus {
        border-color: var(--primary);
        outline: none;
    }
    #error-message {
        color: #d32f2f;
        font-weight: 600;
        margin-bottom: 15px;
        display: none;
    }
    #cartelContainer {
        margin-top: 30px;
        background-color: #fff;
        border-radius: 10px;
        padding: 15px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        display: none; /* Oculto por defecto */
    }
    #cartelCanvas {
        max-width: 100%;
        height: auto;
        border: 1px solid #ddd;
        border-radius: 5px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        display: block;
        margin: 0 auto;
    }
    #compartirCartelBtn {
        margin-top: 15px;
        background: linear-gradient(90deg, #ffc107, #ff9800);
        color: var(--secondary);
        border: none;
    }
    #compartirCartelBtn:hover {
        background: linear-gradient(90deg, #ff9800, #ffc107);
        color: var(--secondary);
    }

    /* LISTA DE MIEMBROS */
    .members-list {
      list-style: none;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
      margin-top: 20px;
      padding: 0;
      text-align: center;
    }
    .members-list li {
      background-color: #f8f8f8;
      padding: 12px;
      border-radius: 8px;
      font-weight: 600;
      color: var(--primary);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.08);
      transition: transform 0.2s;
    }
    .members-list li:hover {
        transform: translateY(-3px);
    }

    /* OTROS ESTILOS DE SECCIÓN (Iframes) */
    iframe {
      width: 100%;
      height: 100%;
      border: 0;
      border-radius: 8px;
    }
    .calendar-container, .map-container {
      height: 400px;
      margin-top: 20px;
    }

    /* FOOTER */
    footer {
      background-color: var(--primary);
      color: white;
      padding: 25px;
      text-align: center;
      border-top: 5px solid var(--accent);
    }
    .social-links {
      margin-bottom: 20px;
    }
    .social-links a {
      color: white;
      font-size: 1.8rem;
      margin: 0 12px;
      transition: var(--transition);
    }
    .social-links a:hover {
      color: var(--accent);
      transform: scale(1.2);
    }
    .copyright {
      font-size: 0.9rem;
      margin: 5px 0;
    }

    /* MEDIA QUERIES */
    @media (max-width: 800px) {
        .nav-links {
            display: none;
            flex-direction: column;
            width: 100%;
            padding: 0;
            text-align: center;
        }
        .nav-links.active {
            display: flex;
        }
        .nav-links li {
            width: 100%;
            border-bottom: 1px solid #eee;
        }
        .nav-links li:last-child {
            border-bottom: none;
        }
        .mobile-menu-btn {
            display: block;
        }
        .btn-group {
            justify-content: space-around;
        }
        .btn {
            width: 48%;
            text-align: center;
            justify-content: center;
            font-size: 0.85rem;
        }
        header h1 {
            font-size: 1.8rem;
        }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div class="logo">
        
        <svg class="cruz-icon" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <path d="M 40 0 L 60 0 L 60 40 L 100 40 L 100 60 L 60 60 L 60 100 L 40 100 L 40 60 L 0 60 L 0 40 L 0 40 L 40 40 L 40 0 Z" fill="white"/>
        </svg>
        <h1>JUMI</h1>
        <p class="header-subtitle">Grupo Juvenil Católico - Encuentra paz, amor y unidad en Cristo</p>
        <p class="angel-credit">Hecho por Ángel</p>
      </div>
    </div>
  </header>

  <nav class="main-nav">
    <div class="nav-container">
      <button class="mobile-menu-btn" id="mobileMenuBtn">
        <i class="fas fa-bars"></i> Menú
      </button>
      <ul class="nav-links" id="navLinks">
        <li><a href="#inicio"><i class="fas fa-home"></i> Inicio</a></li>
        <li><a href="#nosotros"><i class="fas fa-users"></i> Sobre Nosotros</a></li>
        <li><a href="#generador-inspiracion"><i class="fas fa-magic"></i> Cartel</a></li>
        <li><a href="#miembros"><i class="fas fa-user-friends"></i> Miembros</a></li>
        <li><a href="#eventos"><i class="fas fa-calendar-alt"></i> Eventos</a></li>
        <li><a href="#ubicacion"><i class="fas fa-map-marker-alt"></i> Ubicación</a></li>
      </ul>
    </div>
  </nav>

  
<div id="versiculo-del-dia"></div>

  <main>
    
<section id="generador-inspiracion" class="section">
      <h2><i class="fas fa-paint-brush"></i> Generador de Carteles de Inspiración</h2>
      <p>Escribe tu mensaje o reflexión. Se seleccionará una imagen aleatoria de Jesús, y se generará el cartel con tu mensaje y el enlace de JUMI, listo para compartir.</p>
      
      <div style="max-width: 600px; margin: 20px auto;">
        <textarea id="mensajeInput" placeholder="Escribe tu mensaje de fe o reflexión (ej. 'La alegría del Señor es nuestra fuerza.')..."></textarea>
        
        <p id="error-message"></p>
        <button id="generarCartelBtn" class="btn btn-primary" style="width: 100%;"><i class="fas fa-wand-magic-sparkles"></i> Generar Cartel</button>
      </div>

      <div id="cartelContainer">
        <h3>Vista Previa del Cartel</h3>
        <canvas id="cartelCanvas"></canvas>
        <button id="compartirCartelBtn" class="btn btn-primary" style="width: 100%; display: none;"><i class="fas fa-share-alt"></i> Compartir Cartel</button>
        <p style="font-size: 0.8em; margin-top: 10px; color: gray;">*El cartel incluye la foto, tu mensaje y el enlace de JUMI.</p>
      </div>
    </section>
    
<section id="inicio" class="section">
      <h2><i class="fas fa-cross"></i> Bienvenidos a JUMI</h2>
      <p>JUMI es un espacio creado para jóvenes que buscan crecer en su fe católica, compartir experiencias y formar una comunidad basada en los valores cristianos. Aquí encontrarás un ambiente de amor, respeto y fraternidad donde podrás desarrollar tu espiritualidad.</p>
      <p>Nuestro objetivo es fortalecer la relación con Dios a través de la oración, el estudio de la Biblia y el servicio comunitario. Te invitamos a unirte a nuestras actividades y ser parte de esta maravillosa familia espiritual.</p>

      <div class="btn-group">
        <a href="https://whatsapp.com/channel/0029Vb5M9qLAu3aRABUHvq3q" class="btn btn-primary" target="_blank">
          <i class="fab fa-whatsapp"></i> Unirse al Canal
        </a>
      </div>
    </section>

    <section id="nosotros" class="section">
      <h2><i class="fas fa-church"></i> Sobre Nosotros</h2>
      <p>JUMI (Juventud Misionera) es un grupo católico juvenil dedicado a la formación espiritual de sus miembros. Nuestro nombre refleja nuestra devoción a la Virgen María y nuestro compromiso con la unidad en Cristo.</p>
      <p>Fundado en 2007 nuestro grupo ha crecido gracias al trabajo comprometido de jóvenes que comparten el deseo de profundizar en su fe y servir a la comunidad. Organizamos retiros espirituales, charlas formativas, actividades recreativas y proyectos de servicio social.</p>
      <p>Nuestro lema es "Juventud Misionera, Mas Alla De Las Fronteras", y bajo esta premisa buscamos crear un espacio inclusivo donde todos los jóvenes, sin importar su nivel de conocimiento religioso, puedan sentirse acogidos y acompañados en su camino de fe.</p>
    </section>

    <section id="miembros" class="section">
      <h2><i class="fas fa-users"></i> Nuestros Miembros</h2>
      <p>Conoce a los jóvenes que forman parte de nuestra comunidad JUMI. Juntos trabajamos para crecer en fe y servir a los demás.</p>

      <ul class="members-list">
        <li>Steven</li>
        <li>Daniel</li>
        <li>Oscar</li>
        <li>Kenia</li>
        <li>Valentin</li>
        <li>Rudy</li>
        <li>Angel</li>
        <li>Kevin</li>
        <li>Natalia</li>
        <li>Jaime</li>
        <li>Marvin</li>
        <li>Gissela</li>
        <li>Michael</li>
        <li>Franklin</li>
        <li>Mauricio</li>
        <li>Katty</li>
        <li>Jasmin</li>
      </ul>

      <p style="margin-top: 1.5rem; font-style: italic;">"Porque donde dos o tres se reúnen en mi nombre, allí estoy yo en medio de ellos." - Mateo 18:20</p>
    </section>

    <section id="eventos" class="section">
      <h2><i class="fas fa-calendar-alt"></i> Próximos Eventos</h2>
      <p>Mantente informado sobre nuestras próximas actividades. ¡Te esperamos con alegría!</p>

      <div class="calendar-container">
        <iframe 
          src="https://calendar.google.com/calendar/embed?src=8bf36b5b88e056fd52aee2ee97d1503b2d1fda335e319581bfd7ffecfca1b426%40group.calendar.google.com&ctz=America%2FEl_Salvador"
          title="Calendario de Eventos JUMI"
          frameborder="0" 
          scrolling="no">
        </iframe>
      </div>
    </section>

    <section id="ubicacion" class="section">
      <h2><i class="fas fa-map-marked-alt"></i> Ubicación</h2>
      <p>Nuestras reuniones se llevan a cabo en la Iglesia Católica de la Colonia San Francisco Guajoyo. ¡Ven y únete a nosotros!</p>

      <div class="map-container">
        <iframe 
          src="https://maps.google.com/maps?q=Iglesia%20Católica%20Colonia%20San%20Francisco%20Guajoyo&t=&z=15&ie=UTF8&iwloc=&output=embed" 
          title="Ubicación de JUMI"
          allowfullscreen="" 
          loading="lazy">
        </iframe>
      </div>

      <div class="btn-group" style="margin-top: 1.5rem;">
        <a href="https://maps.app.goo.gl/TU_ENLACE_A_DIRECCIONES_AQUÍ" class="btn btn-primary" target="_blank">
          <i class="fas fa-directions"></i> Cómo llegar
        </a>
      </div>
    </section>
  </main>

  <footer>
    <div class="footer-content">
      <div class="social-links">
        <a href="https://www.instagram.com/jumi_medalla.milagrosa?igsh=MXVsdmV0ZTR2bW40ZA==" target="_blank" aria-label="Instagram JUMI"><i class="fab fa-instagram"></i></a>
        <a href="https://whatsapp.com/channel/0029Vb5M9qLAu3aRABUHvq3q" target="_blank" aria-label="Canal WhatsApp"><i class="fab fa-whatsapp"></i></a>
        <a href="mailto:orgjumi@gmail.com" target="_blank" aria-label="Correo electrónico"><i class="fas fa-envelope"></i></a>
      </div>
      <p class="copyright">© 2025 JUMI - Juventud Misionera</p>
      <p class="copyright">Desarrollado con amor por Angel para la comunidad JUMI</p>
    </div>
  </footer>

  
<script>
    // URL y constantes actualizadas
    const URL_JUMI = "https://about-jumi.vercel.app/";
    
    // Lista de imágenes disponibles y sus "zonas seguras" (porcentaje de la altura del canvas)
    const IMAGENES_DISPONIBLES = [
        { 
            nombre: "Jesus2.jpg", // Nombre corregido
            descripcion: "Jesús y la niña dibujando",
            // Zona segura: Superior (el fondo amarillo es un buen lugar)
            safeAreaTop: 0.05, 
            safeAreaBottom: 0.50 
        },
        { 
            nombre: "Jesus3.jpg", // Nombre corregido
            descripcion: "Jesús y la niña caminando en el campo",
            // Zona segura: Superior (el horizonte está a 2/3 de altura, texto encima)
            safeAreaTop: 0.05, 
            safeAreaBottom: 0.35 
        },
        { 
            nombre: "Jesus.jpg", 
            descripcion: "Jesús en el carro",
            // Zona segura: Superior (evitando la parte central inferior donde está Jesús)
            safeAreaTop: 0.05, 
            safeAreaBottom: 0.50 
        }
    ];

    // Lista de groserías para bloqueo (se buscarán en minúsculas y sin acentos)
    const GROSERIAS_BLOQUEO = [
        // Groserías comunes en español
        "mierda", "puta", "cabron", "cabrón", "coño", "joder", "gilipollas", 
        "pendejo", "idiota", "carajo", "verga", "chinga", "vagina", "culo", 
        "teta", "semen", "sexo", "porn", "pene", "puto", "coger", "mamada",
        
        // Palabras sensibles/ofensivas solicitadas
        "gay", "homosexual", "maricon", "maricón", "lesbiana", "trans", "bisexual", 
        
        // Groserías comunes en inglés (mantener solo algunas)
        "fuck", "shit", "asshole", "bitch", "bastard", "damn"
    ];

    // Variable global para almacenar la imagen del cartel una vez cargada
    let cartelImage = null;
    let imagenActual = IMAGENES_DISPONIBLES[0]; // Imagen por defecto

    // Dimensiones del Canvas
    const CARTEL_WIDTH = 800;
    const CARTEL_HEIGHT = 600;
    
    // --- Utilidades ---
    
    function limpiarTexto(texto) {
        // Convierte a minúsculas y quita acentos para una mejor detección de groserías
        return texto.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
    }

    function contieneGroserias(texto) {
        const textoLimpio = limpiarTexto(texto);
        for (const groseria of GROSERIAS_BLOQUEO) {
            // Usa una expresión regular para buscar la palabra completa (con límites de palabra)
            // Agregamos un operador OR para verificar si el textoLimpio contiene el término en cualquier lugar (no solo como palabra completa)
            const regex = new RegExp(`\\b${groseria}\\b|${groseria}`); 
            if (regex.test(textoLimpio)) {
                return true;
            }
        }
        return false;
    }

    function showError(message) {
        const errorEl = document.getElementById('error-message');
        errorEl.textContent = message;
        errorEl.style.display = 'block';
        document.getElementById('cartelContainer').style.display = 'none';
        document.getElementById('compartirCartelBtn').style.display = 'none';
        
        setTimeout(() => {
            errorEl.style.display = 'none';
        }, 8000); 
    }
    // --- Fin Utilidades ---

    // Gestor del versículo diario
    const gestorVersiculo = {
        versiculos: [
          {
            texto: "A toda perfección le he visto límite, pero tus mandamientos son ilimitados.",
            referencia: "Salmos 119:96"
          },
          {
            texto: "Pedid, y se os dará; buscad, y hallaréis; llamad, y se os abrirá.",
            referencia: "Mateo 7:7"
          },
          {
            texto: "El Señor es mi pastor, nada me faltará.",
            referencia: "Salmos 23:1"
          },
          {
            texto: "Todo lo puedo en Cristo que me fortalece.",
            referencia: "Filipenses 4:13"
          },
          {
            texto: "Porque donde dos o tres se reúnen en mi nombre, allí estoy yo en medio de ellos.",
            referencia: "Mateo 18:20"
          }
        ],

        iniciar() {
          this.configurarEventos();
          this.cargarVersiculo();
          this.precargarImagenCartel(); // Precarga la primera imagen (default)
          setInterval(() => this.cargarVersiculo(), 86400000); 
        },

        configurarEventos() {
          // Menú móvil
          document.getElementById('mobileMenuBtn').addEventListener('click', () => {
            document.getElementById('navLinks').classList.toggle('active');
          });

          // Scroll suave
          document.querySelectorAll('nav a').forEach(anchor => {
            anchor.addEventListener('click', function(e) {
              e.preventDefault();
              document.getElementById('navLinks').classList.remove('active'); 
              const target = document.querySelector(this.getAttribute('href'));
              if (target) {
                 window.scrollTo({
                  top: target.offsetTop - 100,
                  behavior: 'smooth'
                });
              }
            });
          });
          
          // Evento para el generador de carteles
          const btnGenerarCartel = document.getElementById('generarCartelBtn');
          if (btnGenerarCartel) {
              btnGenerarCartel.addEventListener('click', generarCartelInspiracion);
          }

          // Evento para compartir el cartel generado
          const btnCompartirCartel = document.getElementById('compartirCartelBtn');
          if (btnCompartirCartel) {
              btnCompartirCartel.addEventListener('click', compartirCartel);
          }
        },

        async cargarVersiculo() {
          try {
            const respuesta = await fetch('https://beta.ourmanna.com/api/v1/get/?format=json&version=RVR1960');
            if (!respuesta.ok) throw new Error('Error al obtener el versículo de la API');
            const data = await respuesta.json();
            
            const texto = data.verse.details.text;
            if (texto && !/you|your|the|is|of|and|but/i.test(texto)) {
                this.mostrarVersiculo(data.verse.details.text, data.verse.details.reference);
            } else {
                throw new Error('Versículo de la API no es válido o está en inglés');
            }
          } catch (error) {
            console.error("Usando versículo local:", error.message);
            this.usarVersiculoLocal();
          }
        },

        usarVersiculoLocal() {
          const hoy = new Date();
          const indice = hoy.getDate() % this.versiculos.length; 
          this.mostrarVersiculo(
            this.versiculos[indice].texto,
            this.versiculos[indice].referencia
          );
        },

        mostrarVersiculo(texto, referencia) {
          const contenedor = document.getElementById('versiculo-del-dia');
          if (!contenedor) return; 

          contenedor.innerHTML = `
            <div class="contenido-verso">
              <p class="texto-verso">"${texto}"</p>
              <p class="referencia-verso">${referencia}</p>
              <div class="botones-compartir">
                <button class="btn-compartir" onclick="compartirVersiculo()">
                  <i class="fas fa-share"></i> Compartir
                </button>
                <a href="https://wa.me/?text=${encodeURIComponent(`Versículo del Día JUMI: "${texto}" - ${referencia} \nConoce más en: ${URL_JUMI}`)}" 
                   class="btn-compartir" 
                   target="_blank">
                  <i class="fab fa-whatsapp"></i> WhatsApp
                </a>
              </div>
            </div>
          `;
        },

        precargarImagenCartel() {
            // Selecciona una imagen aleatoria para precargarla
            const indiceAleatorio = Math.floor(Math.random() * IMAGENES_DISPONIBLES.length);
            imagenActual = IMAGENES_DISPONIBLES[indiceAleatorio];

            const img = new Image();
            img.crossOrigin = 'Anonymous'; 
            img.src = imagenActual.nombre; 

            img.onload = () => {
                cartelImage = img;
                console.log(`Imagen del cartel (${imagenActual.nombre}) precargada con éxito.`);
            };
            img.onerror = () => {
                console.warn(`ADVERTENCIA: No se pudo precargar la imagen '${imagenActual.nombre}'. Se usará el fallback.`);
            };
        }
    };

    // Función para compartir el Versículo del Día 
    function compartirVersiculo() {
        const texto = document.querySelector('.texto-verso').textContent;
        const referencia = document.querySelector('.referencia-verso').textContent;
        const textoFinal = `Versículo del Día JUMI: ${texto} - ${referencia}\n\nConoce más en: ${URL_JUMI}`;
        
        if (navigator.share) {
          navigator.share({
            title: 'Versículo del Día - JUMI',
            text: textoFinal
          }).catch(error => console.log('Error al compartir:', error));
        } else {
            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(textoFinal)}`;
            window.open(whatsappUrl, '_blank');
        }
    }

    // --- FUNCIONALIDAD: GENERADOR DE CARTELES CON CANVAS ---
    
    function generarCartelInspiracion() {
        const mensaje = document.getElementById('mensajeInput').value.trim();
        const canvas = document.getElementById('cartelCanvas');
        const ctx = canvas.getContext('2d');
        const cartelContainer = document.getElementById('cartelContainer');
        const compartirBtn = document.getElementById('compartirCartelBtn');
        
        // Ocultar mensaje de error anterior
        document.getElementById('error-message').style.display = 'none';
        
        if (!mensaje) {
            return showError("¡El mensaje no puede estar vacío! Escribe algo de inspiración.");
        }
        
        // --- VALIDACIÓN DE GROSERÍAS ---
        if (contieneGroserias(mensaje)) {
            // El mensaje de error indica claramente la razón de la censura.
            return showError("⚠️ ¡El mensaje contiene palabras no permitidas! Por favor, elimina cualquier grosería o contenido sensible.");
        }
        // --------------------------------

        // 1. (Re)seleccionar y cargar la imagen aleatoria
        gestorVersiculo.precargarImagenCartel(); // Esto establece una nueva imagenActual y carga la imagen.

        // Configurar dimensiones del canvas
        canvas.width = CARTEL_WIDTH;
        canvas.height = CARTEL_HEIGHT;

        // Limpiar canvas
        ctx.clearRect(0, 0, CARTEL_WIDTH, CARTEL_HEIGHT);

        // 2. Dibujar la Imagen (o Fallback)
        let imgToDraw = cartelImage;

        if (imgToDraw && imgToDraw.complete) {
            // Imagen precargada (éxito)
            const scale = Math.max(CARTEL_WIDTH / imgToDraw.width, CARTEL_HEIGHT / imgToDraw.height);
            const x = (CARTEL_WIDTH / 2) - (imgToDraw.width / 2) * scale;
            const y = (CARTEL_HEIGHT / 2) - (imgToDraw.height / 2) * scale;
            ctx.drawImage(imgToDraw, x, y, imgToDraw.width * scale, imgToDraw.height * scale);
            
            // Aplicar capa semi-transparente para contraste
            ctx.fillStyle = 'rgba(0, 0, 0, 0.4)';
            ctx.fillRect(0, 0, CARTEL_WIDTH, CARTEL_HEIGHT);

        } else {
            // Fallback si la imagen no se cargó o no existe
            ctx.fillStyle = '#6a0dad';
            ctx.fillRect(0, 0, CARTEL_WIDTH, CARTEL_HEIGHT);
            
            ctx.fillStyle = 'white';
            ctx.textAlign = 'center';
            ctx.font = '300 24px Poppins';
            ctx.fillText("¡FOTO NO ENCONTRADA!", CARTEL_WIDTH / 2, 50);
            showError(`La imagen '${imagenActual.nombre}' no se encontró o no se pudo cargar. Se usó un fondo de color sólido.`);
        }

        // 3. Dibujar el Mensaje (Texto del usuario)
        ctx.fillStyle = 'white';
        ctx.textAlign = 'center';
        ctx.strokeStyle = 'rgba(0, 0, 0, 0.8)'; // Sombra/borde del texto
        ctx.lineWidth = 2;
        
        // Obtener zona segura dinámica
        const safeAreaTop = CARTEL_HEIGHT * imagenActual.safeAreaTop;
        const safeAreaBottom = CARTEL_HEIGHT * imagenActual.safeAreaBottom;

        const maxTextWidth = CARTEL_WIDTH - 100; // Ancho máximo general

        let currentFontSize = 48; // Tamaño inicial de fuente
        let lineHeight = currentFontSize * 1.2; // Altura de línea basada en la fuente
        let lines = [];

        // Función auxiliar para calcular las líneas con un tamaño de fuente dado
        const calculateLines = (text, fontSize) => {
            ctx.font = `700 ${fontSize}px Poppins`;
            const words = text.split(' ');
            let tempLines = [];
            let tempLine = '';
            for(let n = 0; n < words.length; n++) {
                const testLine = tempLine + words[n] + ' ';
                if (ctx.measureText(testLine).width > maxTextWidth && n > 0) {
                    tempLines.push(tempLine.trim());
                    tempLine = words[n] + ' ';
                } else {
                    tempLine = testLine;
                }
            }
            tempLines.push(tempLine.trim());
            return tempLines;
        };

        // Reducir el tamaño de la fuente si el texto es muy largo para la zona segura
        do {
            lines = calculateLines(mensaje, currentFontSize);
            lineHeight = currentFontSize * 1.2;
            const totalTextHeight = lines.length * lineHeight;

            // Si el texto cabe en la zona segura
            if (totalTextHeight < (safeAreaBottom - safeAreaTop - (lineHeight * 0.5))) { 
                break; // El texto cabe, salimos del bucle
            }
            currentFontSize -= 2; // Reduce el tamaño de la fuente
        } while (currentFontSize >= 24); // Límite inferior para la fuente

        // Si incluso con la fuente más pequeña sigue siendo demasiado largo, lo dejamos en el mínimo
        if (currentFontSize < 24) {
            currentFontSize = 24; 
            lineHeight = currentFontSize * 1.2;
            lines = calculateLines(mensaje, currentFontSize); 
        }

        // Calcular posición inicial Y para centrar el texto verticalmente en la zona segura superior
        const totalTextHeight = lines.length * lineHeight;
        let startY = safeAreaTop + (safeAreaBottom - safeAreaTop - totalTextHeight) / 2 + (lineHeight * 0.8);


        ctx.font = `700 ${currentFontSize}px Poppins`;

        // Dibujar todas las líneas
        lines.forEach((line, index) => {
            const y = startY + index * lineHeight;
            ctx.strokeText(line, CARTEL_WIDTH / 2, y);
            ctx.fillText(line, CARTEL_WIDTH / 2, y);
        });


        // 4. Dibujar el Enlace de Atribución (pequeño en la esquina inferior derecha)
        ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
        ctx.textAlign = 'right';
        ctx.font = '200 18px Poppins';
        ctx.fillText(`Visítanos: ${URL_JUMI}`, CARTEL_WIDTH - 20, CARTEL_HEIGHT - 20);

        // Mostrar el cartel y el botón de compartir
        cartelContainer.style.display = 'block';
        compartirBtn.style.display = 'block';
    }

    // Función para compartir la imagen del canvas
    async function compartirCartel() {
        const canvas = document.getElementById('cartelCanvas');
        const mensaje = document.getElementById('mensajeInput').value.trim();

        try {
            // Convertir el Canvas a Blob
            const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg', 0.9));
            if (!blob) throw new Error("Fallo al crear el Blob de la imagen.");

            const file = new File([blob], "Cartel_JUMI.jpg", { type: 'image/jpeg' });
            
            const shareData = {
                title: "Inspiración JUMI",
                text: `¡Mira mi mensaje de fe!\n\n${mensaje}\n\nConoce JUMI: ${URL_JUMI}`,
                files: [file]
            };

            if (navigator.canShare && navigator.canShare(shareData)) {
                await navigator.share(shareData);
            } else {
                throw new Error("El navegador no soporta compartir archivos nativamente.");
            }

        } catch (err) {
            console.error("Error al compartir el cartel:", err);
            // Fallback: Descargar la imagen
            const imageURL = canvas.toDataURL('image/jpeg', 0.9);
            const a = document.createElement('a');
            a.href = imageURL;
            a.download = 'Cartel_Inspiracion_JUMI.jpg';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            showError("Tu navegador no soporta compartir directamente. Se ha descargado la imagen.");
        }
    }
    
    // Inicialización al cargar el DOM
    document.addEventListener('DOMContentLoaded', () => {
        gestorVersiculo.iniciar();

        // Animación de secciones
        const observer = new IntersectionObserver((entries, observer) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) {
              entry.target.classList.add('visible');
              observer.unobserve(entry.target);
            }
          });
        }, { threshold: 0.1 });

        document.querySelectorAll('.section').forEach(seccion => {
          observer.observe(seccion);
        });
    });

  </script>
